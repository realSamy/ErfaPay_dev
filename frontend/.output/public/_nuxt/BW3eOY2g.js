import{z as q,A as J,aC as K,e as j,a_ as O,d as v,L as Q,I as W,k as u,l as h,j as s,x as e,v as i,D as n,h as _,_ as X,g as r,B as U,a5 as B,F as V,m as I,n as Y,G as Z,f as k,a7 as L,bp as ee,aB as se}from"./B9jAKPWx.js";import{_ as te,a as ae,b as le,c as oe}from"./iiLnwevK.js";import{_ as ne}from"./OXrPZgjz.js";import{_ as ie}from"./PdnPEoMV.js";import{g as re,h as ce,i as de}from"./mx1Kztk-.js";import"./63q82eq7.js";import"./Dicm8otO.js";import"./C5Zklyxe.js";import"./bcpmAApf.js";const ue={class:"max-h-full h-full flex flex-col lg:flex-row-reverse gap-4 relative"},me={key:0,class:"bg-blue-400 text-white dark:bg-blue-900 w-full p-2 h-100 lg:w-[400px] lg:h-full rounded-md shadow-sm"},_e={class:"justify-end lg:hidden flex"},pe={class:"w-full flex justify-center items-center py-8 font-bold text-xl"},fe={class:"flex lg:flex-col justify-between gap-6"},be={class:"space-y-4"},ge={class:"flex flex-col lg:flex-row lg:justify-between"},he={class:"font-bold text-lg"},ve={class:"flex flex-col lg:flex-row lg:justify-between"},ke={class:"space-x-2"},ye={class:"space-y-3"},xe={class:"space-y-1"},we={class:"grid grid-cols-2"},Ce={class:"font-bold text-end"},$e={class:"grid grid-cols-2"},je={class:"font-bold text-end"},Ue={class:"grid grid-cols-2"},Be={class:"font-bold text-end"},Ve={class:"grid grid-cols-2"},Ie={class:"font-bold text-end"},Le={class:"grid grid-cols-2"},Pe={class:"font-bold text-end"},De={class:"h-full flex flex-col grow contain-size"},Se={class:"justify-between hidden lg:flex"},ze={class:"font-bold"},Te={class:"space-y-2"},Ae=["href"],Fe={class:"truncate max-w-30"},Me={key:0,class:"inline-flex gap-2 flex-wrap"},We=q({__name:"ticket-[id]",async setup(Ne){let b,y;const{t:a}=J(),x={day:"numeric",month:"short",hour:"2-digit",minute:"2-digit",hour12:!1},p=K().params.id,d=j({message:"",attachments:[]}),P=O();P.value={ticket:p};const t=j(),{reply:D}=re(p),{close:S}=de(p),z=v(()=>t.value?.messages||[]),{user:w}=Q(),T=v(()=>({open:a("pages.tickets.titles.waiting_open"),in_progress:a("common.ticket_status.in_progress"),closed:a("common.ticket_status.closed"),resolved:a("common.ticket_status.resolved"),waiting_user:a("common.ticket_status.waiting_user")})),g=v(()=>!!(t.value?.assigned_to?.id!==w.value?.id&&w.value?.role!=="main_admin"||["closed","resolved"].includes(t.value?.status??""))),A=async()=>{if(!t.value)return;const{data:l,error:o}=await D(d.value);l.value?.ok&&(t.value=l.value.data,d.value={message:"",attachments:[]})},F=async()=>{if(!await se({title:a("pages.tickets.labels.mark_as_closed"),message:a("pages.tickets.messages.mark_as_closed",[p]),confirmLabel:a("pages.tickets.labels.mark_as_closed"),confirmColor:"error"}))return;const{data:o}=await S();o.value?.ok&&(t.value=o.value.data)};{const{data:l}=([b,y]=W(()=>ce(p)),b=await b,y(),b);l.value?.ok&&(t.value=l.value.data)}return(l,o)=>{const f=X,C=Z,M=ae,N=ne,R=ee,$=oe,G=ie,E=le,H=te;return r(),u("div",ue,[e(t)?(r(),u("section",me,[s("div",_e,[i(f,{variant:"link",class:"text-white",label:e(a)("navigation.back_tickets"),to:("useLocalePath"in l?l.useLocalePath:e(B))()("dashboard-support"),"trailing-icon":("directionalIcon"in l?l.directionalIcon:e(U))("mdi:chevron-left","mdi:chevron-right")},null,8,["label","to","trailing-icon"])]),s("div",pe,[s("span",null,n(e(t).user.full_name),1)]),s("div",fe,[s("div",be,[s("div",ge,[s("h2",null,n(e(a)("pages.tickets.titles.subject")),1),s("span",he,n(e(t).subject),1)]),s("div",ve,[s("h2",null,n(e(a)("common.tables.operations")),1),s("div",ke,[i(f,{disabled:["closed","resolved"].includes(e(t).status)||!e(t).assigned_to,title:e(a)("pages.tickets.labels.mark_as_closed"),color:"success",icon:"material-symbols:task-rounded",size:"xl",variant:"soft",onClick:F},null,8,["disabled","title"])])])]),s("div",ye,[o[5]||(o[5]=s("h2",{class:"font-medium text-center"},"جزییات تیکت ارسالی",-1)),s("div",xe,[s("div",we,[o[2]||(o[2]=s("span",null,"زمان ایجاد تیکت:",-1)),s("span",Ce,n(l.$d(new Date(e(t).created_at),x)),1)]),s("div",$e,[o[3]||(o[3]=s("span",null,"زمان آخرین بروزرسانی:",-1)),s("span",je,n(l.$d(new Date(e(t).updated_at),x)),1)]),s("div",Ue,[o[4]||(o[4]=s("span",null,"نام پشتیبان:",-1)),s("span",Be,n(e(t).assigned_to?e(t).assigned_to.full_name:"-"),1)]),s("div",Ve,[s("span",null,n(e(a)("common.tables.category"))+":",1),s("span",Ie,n(e(t).category.title_fa),1)]),s("div",Le,[s("span",null,n(e(a)("pages.tickets.titles.current_state"))+":",1),s("span",Pe,n(e(T)[e(t).status]),1)])])])])])):h("",!0),s("section",De,[s("div",Se,[s("div",null,[s("h2",ze,n(e(t)?.subject),1)]),s("div",null,[i(f,{variant:"link",color:"neutral",label:e(a)("navigation.back_tickets"),to:("useLocalePath"in l?l.useLocalePath:e(B))()("dashboard-support"),"trailing-icon":("directionalIcon"in l?l.directionalIcon:e(U))("mdi:chevron-left","mdi:chevron-right")},null,8,["label","to","trailing-icon"])])]),i(H,null,{prompt:_(()=>[["closed","resolved"].includes(e(t)?.status||"")?(r(),k(f,{key:0,label:e(a)("pages.tickets.messages.is_closed"),block:"",color:"warning",disabled:""},null,8,["label"])):h("",!0),e(t)?.assigned_to?(r(),k(E,{key:2,modelValue:e(d).message,"onUpdate:modelValue":o[1]||(o[1]=c=>e(d).message=c),disabled:e(g),maxrows:4,autofocus:"",variant:"subtle",onSubmit:L(A,["prevent"])},{header:_(()=>[e(d).attachments?.length?(r(),u("ul",Me,[(r(!0),u(V,null,I(e(d).attachments,c=>(r(),u("li",null,[i(R,{ui:{root:"rounded-none"},color:"neutral",size:"xl"},{content:_(()=>[i(C,{class:"cursor-pointer",name:"material-symbols:close",onClick:()=>{e(d).attachments=e(d).attachments?.filter(m=>m.name!==c.name)}},null,8,["onClick"])]),default:_(()=>[s("div",null,[i(N,{label:c.name,class:"text-white",icon:"material-symbols:attach-file"},null,8,["label"])])]),_:2},1024)]))),256))])):h("",!0)]),default:_(()=>[i(G,{modelValue:e(d).attachments,"onUpdate:modelValue":o[0]||(o[0]=c=>e(d).attachments=c),disabled:e(g),ui:{base:"border-transparent"},class:"border-transparent",multiple:"",variant:"button"},{default:_(({open:c})=>[i($,{disabled:e(g),class:"rtl:rotate-180",icon:"material-symbols:attach-file",variant:"ghost",onClick:L(m=>c(),["prevent"])},null,8,["disabled","onClick"])]),_:1},8,["modelValue","disabled"]),i($,{disabled:e(g),class:"rtl:rotate-180",icon:"material-symbols:send-rounded",variant:"ghost"},null,8,["disabled"])]),_:1},8,["modelValue","disabled"])):(r(),k(f,{key:1,label:e(a)("pages.tickets.messages.is_waiting_assign"),block:"",color:"neutral",disabled:""},null,8,["label"]))]),default:_(()=>[i(M,{assistant:{variant:"subtle",icon:"material-symbols:support-agent-rounded",ui:{container:"rtl:flex-row-reverse rtl:justify-start"}},messages:e(z),user:{variant:"subtle",icon:"material-symbols:person",ui:{container:"rtl:ms-0 ltr:flex-row-reverse ltr:justify-start"}},"auto-scroll":""},{content:_(({message:c})=>[s("div",Te,[(r(!0),u(V,null,I(c.parts,m=>(r(),u("div",null,[m.type==="text"?(r(),u("p",{key:0,class:Y({"mb-6":c.parts.length>1})},n(m.text),3)):m.type==="file"?(r(),u("a",{key:1,href:m.url,class:"rounded-md font-medium w-40 inline-flex items-center disabled:cursor-not-allowed aria-disabled:cursor-not-allowed disabled:opacity-75 aria-disabled:opacity-75 transition-colors cursor-pointer dark:text-white px-2.5 py-1.5 text-sm gap-1.5 text-primary bg-primary/10 hover:bg-primary/15 active:bg-primary/15 focus:outline-none focus-visible:bg-primary/15 disabled:bg-primary/10 aria-disabled:bg-primary/10",target:"_blank"},[i(C,{name:"material-symbols:attach-file"}),s("span",Fe,n(m.filename||"Download file"),1)],8,Ae)):h("",!0)]))),256))])]),_:1},8,["messages"])]),_:1})])])}}});export{We as default};
