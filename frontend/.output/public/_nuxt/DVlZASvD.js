import{z as E,A as G,d as u,f,g as d,h as g,l as z,a9 as te,x as e,i as S,a8 as H,aC as ae,e as O,I as se,$ as le,k as q,j as l,v as _,D as i,_ as oe,a$ as re,B as ne,a5 as P,F as T,m as ie,M as ue,af as D,ay as de}from"./B9jAKPWx.js";import{_ as J}from"./BRoQb4x9.js";import{_ as me}from"./bcpmAApf.js";import{_ as ce}from"./BfIjcLtu.js";import{_ as _e}from"./PdnPEoMV.js";import{_ as pe}from"./OXrPZgjz.js";import{_ as fe}from"./DqHZlzeT.js";import{_ as ve}from"./B1qJ6Oxd.js";import{_ as be}from"./BrxAOUNe.js";import{b as he}from"./B8pTcEJU.js";import"./jFYhBC76.js";import"./B7bqkIxC.js";import"./DGQ0vsRx.js";const ye=E({__name:"ServiceField",props:{field:{},modelValue:{}},emits:["update:modelValue"],setup(m,{emit:v}){const n=m,b=v,{locale:U}=G(),o=u({get(){return n.modelValue},set(t){b("update:modelValue",t)}}),p=u(()=>U.value==="fa"?n.field.label_fa:n.field.label_en||n.field.label_fa),j=u(()=>{if(!(!n.field.description_fa&&!n.field.description_en))return U.value==="fa"?n.field.description_fa||n.field.description_en:n.field.description_en||n.field.description_fa}),x=u(()=>(n.field.options||[]).map(t=>({label:t,value:t})));return(t,s)=>{const N=te,B=J,h=me,k=ce,C=H;return d(),f(C,{label:e(p),description:e(j),required:m.field.is_required,name:m.field.label_en||m.field.label_fa||"field",size:"xl"},{default:g(()=>[m.field.type==="text"?(d(),f(N,{key:0,modelValue:e(o),"onUpdate:modelValue":s[0]||(s[0]=c=>S(o)?o.value=c:null),placeholder:e(p),size:"lg",class:"w-full"},null,8,["modelValue","placeholder"])):m.field.type==="number"?(d(),f(B,{key:1,modelValue:e(o),"onUpdate:modelValue":s[1]||(s[1]=c=>S(o)?o.value=c:null),placeholder:e(p),size:"lg",min:0,class:"w-full"},null,8,["modelValue","placeholder"])):m.field.type==="textarea"?(d(),f(h,{key:2,modelValue:e(o),"onUpdate:modelValue":s[2]||(s[2]=c=>S(o)?o.value=c:null),placeholder:e(p),rows:5,size:"lg",class:"w-full"},null,8,["modelValue","placeholder"])):m.field.type==="select"&&m.field.options?.length?(d(),f(k,{key:3,modelValue:e(o),"onUpdate:modelValue":s[3]||(s[3]=c=>S(o)?o.value=c:null),items:e(x),placeholder:e(p),class:"w-full",size:"lg"},null,8,["modelValue","items","placeholder"])):z("",!0)]),_:1},8,["label","description","required","name"])}}}),ge=Object.assign(ye,{__name:"InputServiceField"}),Ve={key:0,class:"space-y-8"},$e={class:"flex justify-between items-center"},we={class:"font-bold text-2xl"},Ue={class:"max-w-2xl"},xe={class:"space-y-6"},Ne={class:"rounded-lg border border-accented bg-ui-highlight p-6 space-y-4"},ke={class:"font-semibold text-lg"},Fe={class:"space-y-2 text-sm"},Ie={class:"flex justify-between"},Se={class:"font-medium",dir:"ltr"},qe={class:"flex justify-between"},ze={class:"font-medium",dir:"ltr"},je={class:"flex justify-between"},Be={class:"font-medium",dir:"ltr"},Ce={class:"flex justify-between text-base font-bold"},Me={class:"text-primary",dir:"ltr"},Re={class:"flex justify-end pt-4"},Xe=E({__name:"new-[id]",async setup(m){let v,n;const{t:b,locale:U,n:o}=G(),p=ae().params.id,{createOrder:j,loading:x}=he(),t=O(),s=O({service_id:Number(p),user_amount_irt:0,custom_data:[],attachments:[]}),{data:N,error:B}=([v,n]=se(()=>re(p)),v=await v,n(),v);if(N.value?.ok)t.value=N.value.data,s.value.custom_data=t.value.required_fields.map(({label_en:a,label_fa:r,description_en:y,description_fa:V,is_required:M,type:$,options:R})=>({label_fa:r,label_en:a,description_fa:V,description_en:y,is_required:M,type:$,options:R,value:$==="number"?0:""})),t.value.user_pricing||(s.value.user_amount_irt=Number(t.value.min_amount));else throw le({statusCode:404,statusMessage:B.value?.message||"Unknown error",data:{returnRoute:"dashboard-orders"}});const h=u(()=>t.value?.user_pricing?Number(s.value.user_amount_irt||0):Number(t.value?.min_amount||0)),k=u(()=>t.value?t.value.commission_type==="percent"?Math.round(h.value*Number(t.value.commission_percent)):Number(t.value.commission_fixed):0),C=u(()=>t.value?t.value.commission_type==="percent"?o(Number(t.value.commission_percent),{style:"percent"}):o(Number(t.value.commission_fixed))+" "+b("common.currencies.text.toman"):""),c=u(()=>t.value?o(Number(t.value.tax_rate),{style:"percent"}):""),A=u(()=>{if(!t.value)return 0;const a=h.value;return Math.round(a*Number(t.value.tax_rate))}),K=u(()=>h.value+k.value+A.value),L=u(()=>{if(!t.value||s.value.custom_data?.some(r=>r.is_required?r.value===""||r.value===void 0||r.value===null:!1))return!1;if(t.value.user_pricing){const r=Number(s.value.user_amount_irt);return r>=Number(t.value.min_amount)&&r<=Number(t.value.max_amount)}return!0}),F=a=>o(a)+" تومان",Q=async()=>{if(!L.value)return;const a={...s.value,custom_data:s.value.custom_data?.map(({value:y,...V})=>({...V,value:y}))},r=await j(a);r.ok?(D().add({title:b("orders.messages.order_created"),color:"success"}),await de(P()("dashboard-orders"))):D().add({title:b("common.titles.error"),description:r.errors?.[0]||b("common.errors.unknown"),color:"error"})};return(a,r)=>{const y=oe,V=ge,M=_e,$=H,R=J,W=pe,X=fe,Y=ve,Z=be;return d(),q("div",null,[e(t)?(d(),q("div",Ve,[l("section",$e,[l("h2",we,i(e(t)[`title_${e(U)}`]),1),_(y,{label:a.$t("navigation.back_orders"),to:("useLocalePath"in a?a.useLocalePath:e(P))()("dashboard-orders"),"trailing-icon":("directionalIcon"in a?a.directionalIcon:e(ne))("mdi:chevron-left","mdi:chevron-right"),color:"neutral",variant:"link"},null,8,["label","to","trailing-icon"])]),l("section",Ue,[_(Z,{onSubmit:Q},{default:g(()=>[l("div",xe,[(d(!0),q(T,null,ie(e(s).custom_data,(w,I)=>(d(),q(T,{key:I},[e(s).custom_data?.[I]?(d(),f(V,{key:0,modelValue:e(s).custom_data[I].value,"onUpdate:modelValue":ee=>e(s).custom_data[I].value=ee,field:w},null,8,["modelValue","onUpdate:modelValue","field"])):z("",!0)],64))),128)),_($,{description:a.$t("services.messages.order_attachments"),label:a.$t("services.labels.order_attachments"),size:"xl"},{default:g(()=>[_(M,{modelValue:e(s).attachments,"onUpdate:modelValue":r[0]||(r[0]=w=>e(s).attachments=w),multiple:"",layout:"list"},null,8,["modelValue"])]),_:1},8,["description","label"]),e(t).user_pricing?(d(),f($,{key:0,description:a.$t("services.messages.order_price"),label:a.$t("services.labels.order_price"),required:"",size:"xl"},{default:g(()=>[_(X,{class:"w-full"},{default:g(()=>[_(R,{modelValue:e(s).user_amount_irt,"onUpdate:modelValue":r[1]||(r[1]=w=>e(s).user_amount_irt=w),decrement:!1,increment:!1,max:Number(e(t).max_amount),min:Number(e(t).min_amount),placeholder:a.$t("services.labels.order_price"),class:"w-full",dir:"ltr",required:""},null,8,["modelValue","max","min","placeholder"]),_(W,{label:a.$t("common.currencies.text.toman"),color:"neutral"},null,8,["label"])]),_:1})]),_:1},8,["description","label"])):z("",!0),l("div",Ne,[l("h3",ke,i(a.$t("orders.labels.payment_summary")),1),l("div",Fe,[l("div",Ie,[l("span",null,i(a.$t("orders.labels.base_amount")),1),l("span",Se,i(F(e(h))),1)]),l("div",qe,[l("span",null,i(a.$t("orders.labels.commission"))+" ("+i(e(C))+")",1),l("span",ze,i(F(e(k))),1)]),l("div",je,[l("span",null,i(a.$t("orders.labels.tax"))+" ("+i(e(c))+")",1),l("span",Be,i(F(e(A))),1)]),_(Y),l("div",Ce,[l("span",null,i(a.$t("orders.labels.total_payable")),1),l("span",Me,i(F(e(K))),1)])])]),l("div",Re,[_(y,{disabled:e(x)||!e(L),loading:e(x),color:"primary",size:"xl","trailing-icon":"material-symbols:credit-card",type:"submit"},{default:g(()=>[ue(i(a.$t("orders.labels.pay_and_submit")),1)]),_:1},8,["disabled","loading"])])])]),_:1})])])):z("",!0)])}}});export{Xe as default};
