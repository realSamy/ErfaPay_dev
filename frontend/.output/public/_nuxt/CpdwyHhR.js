import{_ as A}from"./OXrPZgjz.js";import{z as R,a1 as M,e as n,A as N,a5 as E,az as G,K as O,I as q,d as u,aA as m,_ as w,k as D,g as H,v as C,j as J,x as l,i as I}from"./B9jAKPWx.js";import{g as Q,_ as W}from"./CboeWgWE.js";import{_ as X}from"./f4Ke4YGl.js";import{f as Y,a as Z}from"./mx1Kztk-.js";import{s as F,f as p}from"./DcDGsNhf.js";import{_ as ee}from"./D9Vt5tXq.js";const te={class:"w-full space-y-4 pb-4"},ae={class:"flex justify-center border-t border-default pt-4"},se=R({__name:"tickets",async setup(oe){let d,V;const g=M([]),x=n(!0);Y().then(e=>{e.data.value?.ok&&g.splice(0,g.length,...e.data.value.data)}).finally(()=>x.value=!1);const{d:K,n:le,t:a,locale:r}=N(),_=E(),c=G("table"),b=n({pageIndex:0,pageSize:5}),$=O("admin.users"),j=([d,V]=q(()=>Z()),d=await d,V(),d),L=u(()=>j.value.map(e=>({value:e.id,label:r.value==="en"?e.title_en:e.title_fa}))),S=u(()=>[{value:"open",label:a("common.ticket_status.open")},{value:"in_progress",label:a("common.ticket_status.in_progress")},{value:"closed",label:a("common.ticket_status.closed")},{value:"resolved",label:a("common.ticket_status.resolved")},{value:"waiting_user",label:a("common.ticket_status.waiting_user")}]),T=u(()=>[{value:"low",label:a("common.priorities.low")},{value:"medium",label:a("common.priorities.medium")},{value:"high",label:a("common.priorities.high")}]),z=u(()=>$.value.map(e=>({value:e.id,label:e.full_name}))),f=n([]),v=n([]),y=n([]),k=n([]),P=n([{accessorKey:"ticket_id",header:F(a("common.tables.ticket_number")),cell:({row:e})=>{const t=e.getValue("ticket_id");return m(w,{label:ee(t,r.value),variant:"link",to:_({name:"admin-support-tickets-ticket-id",params:{id:t}})})}},{accessorKey:"subject",header:a("common.tables.topic"),cell:({row:e})=>{const t=e.getValue("ticket_id"),s=e.getValue("subject");return m(w,{label:s,variant:"link",to:_({name:"admin-support-tickets-ticket-id",params:{id:t}})})}},{accessorKey:"user",header:p(a("common.tables.user"),z,k),enableColumnFilter:!0,filterFn:(e,t,s)=>{const o=e.getValue(t);return o?s.includes(o.id):!1},cell:({row:e})=>{const t=e.getValue("user"),s=t?.country_code?.toLowerCase(),o=t?.id;return t?m(w,{icon:s?`cif:${s}`:"material-symbols:globe",label:t.full_name,variant:"link",to:_({name:"admin-users-id",params:{id:o}})}):"—"}},{accessorKey:"category",header:p(a("common.tables.category"),L,f),enableColumnFilter:!0,filterFn:(e,t,s)=>{const o=e.getValue(t);return o?s.includes(o.id):!1},sortingFn:(e,t,s)=>{const o=e.getValue(s),i=t.getValue(s);if(!o||!i)return 0;const U=o[`title_${r.value}`],B=i[`title_${r.value}`];return U.localeCompare(B)},cell:({row:e})=>e.getValue("category")?.[`title_${r.value}`]||"—"},{accessorKey:"status",header:p(a("common.tables.state"),S,v),enableColumnFilter:!0,filterFn:"arrIncludesSome",cell:({row:e})=>{const t=e.getValue("status"),{color:s,label:o}={open:{color:"warning",label:a("common.ticket_status.open")},in_progress:{color:"info",label:a("common.ticket_status.in_progress")},closed:{color:"success",label:a("common.ticket_status.closed")},resolved:{color:"success",label:a("common.ticket_status.resolved")},waiting_user:{color:"info",label:a("common.ticket_status.waiting_user")}}[t];return m(A,{class:"capitalize w-full justify-center",variant:"subtle",color:s},()=>o)}},{accessorKey:"priority",header:p(a("common.tables.priority"),T,y),enableColumnFilter:!0,filterFn:"arrIncludesSome",cell:({row:e})=>{const t=e.getValue("priority"),{color:s,label:o}={low:{color:"success",label:a("common.priorities.low")},medium:{color:"warning",label:a("common.priorities.medium")},high:{color:"error",label:a("common.priorities.high")}}[t];return m(A,{class:"capitalize w-full justify-center",variant:"subtle",color:s},()=>o)}},{accessorKey:"assigned_to",header:F(a("common.tables.assigned_to")),cell:({row:e})=>{const t=e.getValue("assigned_to");return t?t.full_name:"—"}},{accessorKey:"created_at",header:F(a("common.tables.created_at")),cell:({row:e})=>K(e.getValue("created_at"),{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}]),h=u(()=>{const e=[];return f.value.length&&e.push({id:"category",value:f.value}),v.value.length&&e.push({id:"status",value:v.value}),y.value.length&&e.push({id:"priority",value:y.value}),k.value.length&&e.push({id:"user",value:k.value}),e});return(e,t)=>{const s=W,o=X;return H(),D("div",te,[C(s,{ref_key:"table",ref:c,"column-filters":l(h),"onUpdate:columnFilters":t[0]||(t[0]=i=>I(h)?h.value=i:null),pagination:l(b),"onUpdate:pagination":t[1]||(t[1]=i=>I(b)?b.value=i:null),columns:l(P),data:l(g),filtering:!0,loading:l(x),"pagination-options":{getPaginationRowModel:l(Q)()},class:"h-100",sticky:""},null,8,["column-filters","pagination","columns","data","loading","pagination-options"]),J("div",ae,[C(o,{"default-page":(l(c)?.tableApi?.getState().pagination.pageIndex||0)+1,"items-per-page":l(c)?.tableApi?.getState().pagination.pageSize,total:l(c)?.tableApi?.getFilteredRowModel().rows.length,"onUpdate:page":t[2]||(t[2]=i=>l(c)?.tableApi?.setPageIndex(i-1))},null,8,["default-page","items-per-page","total"])])])}}}),pe=Object.assign(se,{__name:"TableAdminTickets"});export{pe as _};
