import{z as K,A as O,aC as Q,e as V,a_ as W,d as x,L as X,I as Y,k as u,l as k,j as s,x as e,D as n,v as c,h as _,_ as Z,g as i,F as B,m as A,n as ee,G as se,f as h,a7 as D,bp as te,aB as z}from"./B9jAKPWx.js";import{_ as ae,a as le,b as oe,c as ne}from"./iiLnwevK.js";import{_ as ie}from"./OXrPZgjz.js";import{_ as re}from"./PdnPEoMV.js";import{j as ce,k as de,l as ue}from"./mx1Kztk-.js";import"./63q82eq7.js";import"./Dicm8otO.js";import"./C5Zklyxe.js";import"./bcpmAApf.js";const me={class:"max-h-full h-full flex flex-col lg:flex-row-reverse gap-4 relative"},_e={key:0,class:"bg-blue-400 text-white dark:bg-blue-900 w-full p-2 h-80 lg:w-[400px] lg:h-full rounded-md shadow-sm"},pe={class:"w-full flex justify-center items-center py-8 font-bold text-xl"},fe={class:"flex lg:flex-col justify-between gap-6"},ge={class:"space-y-4"},be={class:"flex flex-col lg:flex-row lg:justify-between"},ve={class:"font-bold text-lg"},ke={class:"flex flex-col lg:flex-row lg:justify-between"},he={class:"space-x-2"},ye={class:"space-y-3"},xe={class:"space-y-1"},we={class:"grid grid-cols-2"},Ce={class:"font-bold text-end"},Ue={class:"grid grid-cols-2"},$e={class:"font-bold text-end"},je={class:"grid grid-cols-2"},Ve={class:"font-bold text-end"},Be={class:"grid grid-cols-2"},Ae={class:"font-bold text-end"},De={class:"grid grid-cols-2"},ze={class:"font-bold text-end"},Le={class:"h-full flex flex-col grow contain-size"},Se={class:"space-y-2"},Te=["href"],Me={class:"truncate max-w-30"},Pe={key:0,class:"inline-flex gap-2 flex-wrap"},Oe=K({__name:"ticket-[id]",async setup(Re){let b,w;const{t:a}=O(),C={day:"numeric",month:"short",hour:"2-digit",minute:"2-digit",hour12:!1},p=Q().params.id,d=V({message:"",attachments:[]}),L=W();L.value={ticket:p};const t=V(),{reply:S,isLoading:T}=ce(p),{update:y}=ue(p),M=x(()=>t.value?.messages||[]),{user:v}=X(),P=x(()=>({open:a("pages.tickets.titles.waiting_open"),in_progress:a("common.ticket_status.in_progress"),closed:a("common.ticket_status.closed"),resolved:a("common.ticket_status.resolved"),waiting_user:a("common.ticket_status.waiting_user")})),f=x(()=>!!(t.value?.assigned_to?.id!==v.value?.id&&v.value?.role!=="main_admin"||["closed","resolved"].includes(t.value?.status??""))),U=async()=>{if(!v.value?.id)return;const{data:o}=await y({assigned_to:v.value.id});o.value?.ok&&(t.value=o.value.data)},R=async()=>{if(!t.value)return;const o=await S(d.value);o.value?.ok&&(t.value=o.value.data,d.value={message:"",attachments:[]})},F=async()=>{if(!await z({title:a("pages.tickets.labels.mark_as_closed"),message:a("pages.tickets.messages.mark_as_closed",[p]),confirmLabel:a("pages.tickets.labels.mark_as_closed"),confirmColor:"error"}))return;const{data:l}=await y({status:"resolved"});l.value?.ok&&(t.value=l.value.data)},I=async()=>{if(!await z({title:a("pages.tickets.labels.mark_as_progress"),message:a("pages.tickets.messages.mark_as_progress",[p]),confirmLabel:a("pages.tickets.labels.change_state"),confirmColor:"warning"}))return;await U();const{data:l}=await y({status:"in_progress"});l.value?.ok&&(t.value=l.value.data)};{const{data:o}=([b,w]=Y(()=>de(p)),b=await b,w(),b);o.value?.ok&&(t.value=o.value.data)}return(o,l)=>{const g=Z,$=se,N=le,G=ie,E=te,j=ne,H=re,q=oe,J=ae;return i(),u("div",me,[e(t)?(i(),u("section",_e,[s("div",pe,[s("span",null,n(e(t).user.full_name),1)]),s("div",fe,[s("div",ge,[s("div",be,[s("h2",null,n(e(a)("pages.tickets.titles.subject")),1),s("span",ve,n(e(t).subject),1)]),s("div",ke,[s("h2",null,n(e(a)("common.tables.operations")),1),s("div",he,[c(g,{disabled:["closed","resolved"].includes(e(t).status),title:e(a)("pages.tickets.labels.mark_as_closed"),color:"success",icon:"material-symbols:task-rounded",size:"xl",variant:"soft",onClick:F},null,8,["disabled","title"]),c(g,{disabled:["closed","resolved","in_progress"].includes(e(t).status),title:e(a)("pages.tickets.labels.mark_as_progress"),color:"warning",icon:"material-symbols:pending-actions-rounded",size:"xl",variant:"soft",onClick:I},null,8,["disabled","title"])])])]),s("div",ye,[l[5]||(l[5]=s("h2",{class:"font-medium text-center"},"جزییات تیکت ارسالی",-1)),s("div",xe,[s("div",we,[l[2]||(l[2]=s("span",null,"زمان ایجاد تیکت:",-1)),s("span",Ce,n(o.$d(new Date(e(t).created_at),C)),1)]),s("div",Ue,[l[3]||(l[3]=s("span",null,"زمان آخرین بروزرسانی:",-1)),s("span",$e,n(o.$d(new Date(e(t).updated_at),C)),1)]),s("div",je,[l[4]||(l[4]=s("span",null,"آخرین پاسخ توسط:",-1)),s("span",Ve,n(e(t).assigned_to?e(t).assigned_to.full_name:"-"),1)]),s("div",Be,[s("span",null,n(e(a)("common.tables.category"))+":",1),s("span",Ae,n(e(t).category.title_fa),1)]),s("div",De,[s("span",null,n(e(a)("pages.tickets.titles.current_state"))+":",1),s("span",ze,n(e(P)[e(t).status]),1)])])])])])):k("",!0),s("section",Le,[c(J,null,{prompt:_(()=>[["closed","resolved"].includes(e(t)?.status||"")?(i(),h(g,{key:0,disabled:"",label:e(a)("pages.tickets.messages.is_closed"),block:"",color:"warning"},null,8,["label"])):e(f)?(i(),h(g,{key:1,disabled:"",label:e(a)("pages.tickets.messages.is_assigned_to_other"),block:"",color:"warning"},null,8,["label"])):k("",!0),e(t)?.assigned_to?(i(),h(q,{key:2,modelValue:e(d).message,"onUpdate:modelValue":l[1]||(l[1]=r=>e(d).message=r),disabled:e(f),maxrows:4,autofocus:"",variant:"subtle",onSubmit:D(R,["prevent"])},{header:_(()=>[e(d).attachments?.length?(i(),u("ul",Pe,[(i(!0),u(B,null,A(e(d).attachments,r=>(i(),u("li",null,[c(E,{ui:{root:"rounded-none"},color:"neutral",size:"xl"},{content:_(()=>[c($,{class:"cursor-pointer",name:"material-symbols:close",onClick:()=>{e(d).attachments=e(d).attachments?.filter(m=>m.name!==r.name)}},null,8,["onClick"])]),default:_(()=>[s("div",null,[c(G,{label:r.name,class:"text-white",icon:"material-symbols:attach-file"},null,8,["label"])])]),_:2},1024)]))),256))])):k("",!0)]),default:_(()=>[c(H,{disabled:e(f),modelValue:e(d).attachments,"onUpdate:modelValue":l[0]||(l[0]=r=>e(d).attachments=r),ui:{base:"border-transparent"},class:"border-transparent",multiple:"",variant:"button"},{default:_(({open:r})=>[c(j,{disabled:e(f),class:"rtl:rotate-180",icon:"material-symbols:attach-file",variant:"ghost",onClick:D(m=>r(),["prevent"])},null,8,["disabled","onClick"])]),_:1},8,["disabled","modelValue"]),c(j,{disabled:e(f),class:"rtl:rotate-180",icon:"material-symbols:send-rounded",variant:"ghost"},null,8,["disabled"])]),_:1},8,["modelValue","disabled"])):(i(),h(g,{key:3,label:e(a)("pages.tickets.labels.assign_to_self"),loading:e(T),block:"",class:"text-center",color:"success",variant:"soft",onClick:U},null,8,["label","loading"]))]),default:_(()=>[c(N,{assistant:{variant:"subtle",icon:"material-symbols:support-agent-rounded",ui:{container:"rtl:flex-row-reverse rtl:justify-start"}},messages:e(M),user:{variant:"subtle",icon:"material-symbols:person",ui:{container:"rtl:ms-0 ltr:flex-row-reverse ltr:justify-start"}},"auto-scroll":""},{content:_(({message:r})=>[s("div",Se,[(i(!0),u(B,null,A(r.parts,m=>(i(),u("div",null,[m.type==="text"?(i(),u("p",{key:0,class:ee({"mb-6":r.parts.length>1})},n(m.text),3)):m.type==="file"?(i(),u("a",{key:1,href:m.url,class:"rounded-md font-medium w-40 inline-flex items-center disabled:cursor-not-allowed aria-disabled:cursor-not-allowed disabled:opacity-75 aria-disabled:opacity-75 transition-colors cursor-pointer dark:text-white px-2.5 py-1.5 text-sm gap-1.5 text-primary bg-primary/10 hover:bg-primary/15 active:bg-primary/15 focus:outline-none focus-visible:bg-primary/15 disabled:bg-primary/10 aria-disabled:bg-primary/10",target:"_blank"},[c($,{name:"material-symbols:attach-file"}),s("span",Me,n(m.filename||"Download file"),1)],8,Te)):k("",!0)]))),256))])]),_:1},8,["messages"])]),_:1})])])}}});export{Oe as default};
