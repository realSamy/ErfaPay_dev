import{e as s,ae as i,$ as g,d as A,w as F,o as _,ad as p,L as O}from"./B9jAKPWx.js";const b=a=>{const e=new FormData;return["service_id","user_amount_irt"].forEach(u=>{const l=a[u];l!=null&&l!==""&&e.append(u,String(l))}),a.custom_data?.length&&e.append("custom_data",JSON.stringify(a.custom_data)),a.attachments?.length&&a.attachments.forEach(u=>e.append("attachments",u)),e},E=()=>{const a=s([]),e=s(!1),t=s(null);return{orders:a,loading:e,error:t,fetchOrders:async()=>{e.value=!0,t.value=null;try{const{data:l}=await i("/api/orders/",{});a.value=l.value?.data||[]}catch(l){t.value=l.message}finally{e.value=!1}}}},P=(a,e,t,u=20,l)=>{const n=s([]),r=s(!1),m=s(null);typeof u!="number"&&(u=u.value);const c=s(1),v=s(0),y=A(()=>Math.ceil(v.value/u)),f=async(o=c.value)=>{if(O().isAdmin.value){r.value=!0,m.value=null;try{const d={page:o,page_size:u,user_id:l};a?.value&&(d.status=a.value),e?.value&&(d.search=e.value),t?.value&&(d.sorting=t.value);const{data:h}=await i("/api/orders/admin/",{method:"GET",params:d});h.value?(n.value=h.value.results,v.value=h.value.count,c.value=o):(n.value=[],v.value=0)}catch(d){m.value=d.message,n.value=[],v.value=0}finally{r.value=!1}}},w=async o=>{o>=1&&o<=y.value&&o!==c.value&&await f(o)};return F([a,e,t],async()=>{c.value=1,await f(1)}),_(async()=>await f(1)),{orders:n,loading:r,error:m,refresh:f,currentPage:c,totalItems:p(v),pageCount:p(y),goToPage:w}},T=()=>{const a=s(!1),e=s(null),t=s(null);return{loading:a,error:e,orderId:t,createOrder:async l=>{a.value=!0,e.value=null;try{const n=b(l),{data:r}=await i("/api/orders/create/",{method:"POST",body:n});if(r.value?.ok)return t.value=r.value.order_id,r.value;e.value=r.value?.error||"Failed to create order"}catch(n){e.value=n.message}finally{a.value=!1}}}},x=async a=>{const{data:e}=await i(`/api/orders/admin/${a}/`);if(e.value?.ok)return{order:s(e.value.data)};throw g({message:"Order not found"})},I=()=>{const a=s(!1),e=s(null),t=s(null);return{loading:a,error:e,updatedOrder:t,updateOrder:async(l,n)=>{if(O().isAdmin.value){a.value=!0,e.value=null;try{const{data:r}=await i(`/api/orders/admin/${l}/`,{method:"PATCH",body:n});if(r.value?.ok)return t.value=r.value.data,r.value;e.value=r.value?.error||"Failed to update order"}catch(r){e.value=r.message}finally{a.value=!1}}}}};export{E as a,T as b,x as c,I as d,P as u};
