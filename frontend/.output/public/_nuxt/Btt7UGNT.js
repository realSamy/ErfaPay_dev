import{N as X,d as T,O as B,Q as Z,R as J,S as K,T as ee,U as te,V as ae,w as $,W as se,X as ne,e as E,s as L,Y as oe,Z as re,$ as ie,x as p,a0 as ce,a1 as G,a2 as le,a3 as ue,z as de,a4 as fe,a5 as he,A as _e,a6 as me,k as q,v as P,h as O,n as ye,E as ve,g as R,j as z,a7 as ge,f as A,l as be,a8 as pe,a9 as De,i as k,_ as we,M as H,D as U,aa as I,ab as Be}from"./B9jAKPWx.js";import{c as Ce}from"./D11N8NiO.js";const Ee=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],Pe=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],Oe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",C=[];class Se{_data=new x;_hash=new x([...Ee]);_nDataBytes=0;_minBufferSize=0;finalize(e){e&&this._append(e);const a=this._nDataBytes*8,t=this._data.sigBytes*8;return this._data.words[t>>>5]|=128<<24-t%32,this._data.words[(t+64>>>9<<4)+14]=Math.floor(a/4294967296),this._data.words[(t+64>>>9<<4)+15]=a,this._data.sigBytes=this._data.words.length*4,this._process(),this._hash}_doProcessBlock(e,a){const t=this._hash.words;let s=t[0],i=t[1],o=t[2],r=t[3],h=t[4],_=t[5],c=t[6],u=t[7];for(let l=0;l<64;l++){if(l<16)C[l]=e[a+l]|0;else{const D=C[l-15],f=(D<<25|D>>>7)^(D<<14|D>>>18)^D>>>3,y=C[l-2],M=(y<<15|y>>>17)^(y<<13|y>>>19)^y>>>10;C[l]=f+C[l-7]+M+C[l-16]}const b=h&_^~h&c,d=s&i^s&o^i&o,m=(s<<30|s>>>2)^(s<<19|s>>>13)^(s<<10|s>>>22),g=(h<<26|h>>>6)^(h<<21|h>>>11)^(h<<7|h>>>25),v=u+g+b+Pe[l]+C[l],w=m+d;u=c,c=_,_=h,h=r+v|0,r=o,o=i,i=s,s=v+w|0}t[0]=t[0]+s|0,t[1]=t[1]+i|0,t[2]=t[2]+o|0,t[3]=t[3]+r|0,t[4]=t[4]+h|0,t[5]=t[5]+_|0,t[6]=t[6]+c|0,t[7]=t[7]+u|0}_append(e){typeof e=="string"&&(e=x.fromUtf8(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes}_process(e){let a,t=this._data.sigBytes/64;e?t=Math.ceil(t):t=Math.max((t|0)-this._minBufferSize,0);const s=t*16,i=Math.min(s*4,this._data.sigBytes);if(s){for(let o=0;o<s;o+=16)this._doProcessBlock(this._data.words,o);a=this._data.words.splice(0,s),this._data.sigBytes-=i}return new x(a,i)}}class x{words;sigBytes;constructor(e,a){e=this.words=e||[],this.sigBytes=a===void 0?e.length*4:a}static fromUtf8(e){const a=unescape(encodeURIComponent(e)),t=a.length,s=[];for(let i=0;i<t;i++)s[i>>>2]|=(a.charCodeAt(i)&255)<<24-i%4*8;return new x(s,t)}toBase64(){const e=[];for(let a=0;a<this.sigBytes;a+=3){const t=this.words[a>>>2]>>>24-a%4*8&255,s=this.words[a+1>>>2]>>>24-(a+1)%4*8&255,i=this.words[a+2>>>2]>>>24-(a+2)%4*8&255,o=t<<16|s<<8|i;for(let r=0;r<4&&a*8+r*6<this.sigBytes*8;r++)e.push(Oe.charAt(o>>>6*(3-r)&63))}return e.join("")}concat(e){if(this.words[this.sigBytes>>>2]&=4294967295<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4),this.sigBytes%4)for(let a=0;a<e.sigBytes;a++){const t=e.words[a>>>2]>>>24-a%4*8&255;this.words[this.sigBytes+a>>>2]|=t<<24-(this.sigBytes+a)%4*8}else for(let a=0;a<e.sigBytes;a+=4)this.words[this.sigBytes+a>>>2]=e.words[a>>>2];this.sigBytes+=e.sigBytes}}function xe(n){return new Se().finalize(n).toBase64()}function S(n){return xe(X(n))}const Me={trailing:!0};function Ue(n,e=25,a={}){if(a={...Me,...a},!Number.isFinite(e))throw new TypeError("Expected `wait` to be a finite number");let t,s,i=[],o,r;const h=(u,l)=>(o=Te(n,u,l),o.finally(()=>{if(o=null,a.trailing&&r&&!s){const b=h(u,r);return r=null,b}}),o),_=function(...u){return a.trailing&&(r=u),o||new Promise(l=>{const b=!s&&a.leading;clearTimeout(s),s=setTimeout(()=>{s=null;const d=a.leading?t:h(this,u);r=null;for(const m of i)m(d);i=[]},e),b?(t=h(this,u),l(t)):i.push(l)})},c=u=>{u&&(clearTimeout(u),s=null)};return _.isPending=()=>!!s,_.cancel=()=>{c(s),i=[],r=null},_.flush=()=>{if(c(s),!r||o)return;const u=r;return r=null,h(this,u)},_}async function Te(n,e,a){return await n.apply(e,a)}function Fe(...n){const e=typeof n[n.length-1]=="string"?n.pop():void 0;Re(n[0],n[1])&&n.unshift(e);let[a,t,s={}]=n,i=!1;const o=T(()=>B(a));if(typeof o.value!="string")throw new TypeError("[nuxt] [useAsyncData] key must be a string.");if(typeof t!="function")throw new TypeError("[nuxt] [useAsyncData] handler must be a function.");const r=Z();s.server??=!0,s.default??=Ne,s.getCachedData??=Q,s.lazy??=!1,s.immediate??=!0,s.deep??=J.deep,s.dedupe??="cancel",s._functionName,r._asyncData[o.value];function h(){const d={cause:"initial",dedupe:s.dedupe};return r._asyncData[o.value]?._init||(d.cachedData=s.getCachedData(o.value,r,{cause:"initial"}),r._asyncData[o.value]=W(r,o.value,t,s,d.cachedData)),()=>r._asyncData[o.value].execute(d)}const _=h(),c=r._asyncData[o.value];c._deps++;const u=s.server!==!1&&r.payload.serverRendered;{let d=function(f){const y=r._asyncData[f];y?._deps&&(y._deps--,y._deps===0&&y?._off())};const m=K();if(m&&u&&s.immediate&&!m.sp&&(m.sp=[]),m&&!m._nuxtOnBeforeMountCbs){m._nuxtOnBeforeMountCbs=[];const f=m._nuxtOnBeforeMountCbs;ee(()=>{f.forEach(y=>{y()}),f.splice(0,f.length)}),te(()=>f.splice(0,f.length))}const g=m&&(m._nuxtClientOnly||ae(Ce,!1));u&&r.isHydrating&&(c.error.value||c.data.value!==void 0)?c.status.value=c.error.value?"error":"success":m&&(!g&&r.payload.serverRendered&&r.isHydrating||s.lazy)&&s.immediate?m._nuxtOnBeforeMountCbs.push(_):s.immediate&&c.status.value!=="success"&&_();const v=ne(),w=$(o,(f,y)=>{if((f||y)&&f!==y){i=!0;const M=r._asyncData[y]?.data.value!==void 0,N=r._asyncDataPromises[y]!==void 0,j={cause:"initial",dedupe:s.dedupe};if(!r._asyncData[f]?._init){let F;y&&M?F=r._asyncData[y].data.value:(F=s.getCachedData(f,r,{cause:"initial"}),j.cachedData=F),r._asyncData[f]=W(r,f,t,s,F)}r._asyncData[f]._deps++,y&&d(y),(s.immediate||M||N)&&r._asyncData[f].execute(j),ce(()=>{i=!1})}},{flush:"sync"}),D=s.watch?$(s.watch,()=>{i||c._execute({cause:"watch",dedupe:s.dedupe})}):()=>{};v&&se(()=>{w(),D(),d(o.value)})}const l={data:V(()=>r._asyncData[o.value]?.data),pending:V(()=>r._asyncData[o.value]?.pending),status:V(()=>r._asyncData[o.value]?.status),error:V(()=>r._asyncData[o.value]?.error),refresh:(...d)=>r._asyncData[o.value]?._init?r._asyncData[o.value].execute(...d):h()(),execute:(...d)=>l.refresh(...d),clear:()=>{const d=r._asyncData[o.value];if(d?._abortController)try{d._abortController.abort(new DOMException("AsyncData aborted by user.","AbortError"))}finally{d._abortController=void 0}Y(r,o.value)}},b=Promise.resolve(r._asyncDataPromises[o.value]).then(()=>l);return Object.assign(b,l),b}function V(n){return T({get(){return n()?.value},set(e){const a=n();a&&(a.value=e)}})}function Re(n,e){return!(typeof n=="string"||typeof n=="object"&&n!==null||typeof n=="function"&&typeof e=="function")}function Y(n,e){e in n.payload.data&&(n.payload.data[e]=void 0),e in n.payload._errors&&(n.payload._errors[e]=void 0),n._asyncData[e]&&(n._asyncData[e].data.value=p(n._asyncData[e]._default()),n._asyncData[e].error.value=void 0,n._asyncData[e].status.value="idle"),e in n._asyncDataPromises&&(n._asyncDataPromises[e]=void 0)}function Ve(n,e){const a={};for(const t of e)a[t]=n[t];return a}function W(n,e,a,t,s){n.payload._errors[e]??=void 0;const i=t.getCachedData!==Q,o=a,r=t.deep?E:L,h=s!==void 0,_=n.hook("app:data:refresh",async u=>{(!u||u.includes(e))&&await c.execute({cause:"refresh:hook"})}),c={data:r(h?s:t.default()),pending:T(()=>c.status.value==="pending"),error:oe(n.payload._errors,e),status:L("idle"),execute:(...u)=>{const[l,b=void 0]=u,d=l&&b===void 0&&typeof l=="object"?l:{};if(n._asyncDataPromises[e]&&(d.dedupe??t.dedupe)==="defer")return n._asyncDataPromises[e];{const g="cachedData"in d?d.cachedData:t.getCachedData(e,n,{cause:d.cause??"refresh:manual"});if(g!==void 0)return n.payload.data[e]=c.data.value=g,c.error.value=void 0,c.status.value="success",Promise.resolve(g)}c._abortController&&c._abortController.abort(new DOMException("AsyncData request cancelled by deduplication","AbortError")),c._abortController=new AbortController,c.status.value="pending";const m=new Promise((g,v)=>{try{const w=d.timeout??t.timeout,D=je([c._abortController?.signal,d?.signal],w);if(D.aborted){const f=D.reason;v(f instanceof Error?f:new DOMException(String(f??"Aborted"),"AbortError"));return}return D.addEventListener("abort",()=>{const f=D.reason;v(f instanceof Error?f:new DOMException(String(f??"Aborted"),"AbortError"))},{once:!0}),Promise.resolve(o(n,{signal:D})).then(g,v)}catch(w){v(w)}}).then(async g=>{let v=g;t.transform&&(v=await t.transform(g)),t.pick&&(v=Ve(v,t.pick)),n.payload.data[e]=v,c.data.value=v,c.error.value=void 0,c.status.value="success"}).catch(g=>{if(!(n._asyncDataPromises[e]&&n._asyncDataPromises[e]!==m)&&!c._abortController?.signal.aborted){if(typeof DOMException<"u"&&g instanceof DOMException&&g.name==="AbortError"){c.status.value="idle";return}c.error.value=ie(g),c.data.value=p(t.default()),c.status.value="error"}}).finally(()=>{delete n._asyncDataPromises[e]});return n._asyncDataPromises[e]=m,n._asyncDataPromises[e]},_execute:Ue((...u)=>c.execute(...u),0,{leading:!0}),_default:t.default,_deps:0,_init:!0,_hash:void 0,_off:()=>{_(),n._asyncData[e]?._init&&(n._asyncData[e]._init=!1),i||re(()=>{n._asyncData[e]?._init||(Y(n,e),c.execute=()=>Promise.resolve())})}};return c}const Ne=()=>{},Q=(n,e,a)=>{if(e.isHydrating)return e.payload.data[n];if(a.cause!=="refresh:manual"&&a.cause!=="refresh:hook")return e.static.data[n]};function je(n,e){const a=n.filter(i=>!!i);if(typeof e=="number"&&e>=0){const i=AbortSignal.timeout?.(e);i&&a.push(i)}if(AbortSignal.any)return AbortSignal.any(a);const t=new AbortController;for(const i of a)if(i.aborted){const o=i.reason??new DOMException("Aborted","AbortError");try{t.abort(o)}catch{t.abort()}return t.signal}const s=()=>{const o=a.find(r=>r.aborted)?.reason??new DOMException("Aborted","AbortError");try{t.abort(o)}catch{t.abort()}};for(const i of a)i.addEventListener?.("abort",s,{once:!0});return t.signal}function ze(n,e,a){const[t={},s]=typeof e=="string"?[{},e]:[e,a],i=T(()=>B(n)),o=T(()=>B(t.key)||"$f"+S([s,typeof i.value=="string"?i.value:"",...$e(t)]));if(!t.baseURL&&typeof i.value=="string"&&i.value[0]==="/"&&i.value[1]==="/")throw new Error('[nuxt] [useFetch] the request URL must not start with "//".');const{server:r,lazy:h,default:_,transform:c,pick:u,watch:l,immediate:b,getCachedData:d,deep:m,dedupe:g,timeout:v,...w}=t,D=G({...le,...w,cache:typeof t.cache=="boolean"?void 0:t.cache}),f={server:r,lazy:h,default:_,transform:c,pick:u,immediate:b,getCachedData:d,deep:m,dedupe:g,timeout:v,watch:l===!1?[]:[...l||[],D]};return Fe(l===!1?o.value:o,(M,{signal:N})=>(t.$fetch||globalThis.$fetch)(i.value,{signal:N,...D}),f)}function $e(n){const e=[B(n.method)?.toUpperCase()||"GET",B(n.baseURL)];for(const a of[n.params||n.query]){const t=B(a);if(!t)continue;const s={};for(const[i,o]of Object.entries(t))s[B(i)]=B(o);e.push(s)}if(n.body){const a=B(n.body);if(!a)e.push(S(a));else if(a instanceof ArrayBuffer)e.push(S(Object.fromEntries([...new Uint8Array(a).entries()].map(([t,s])=>[t,s.toString()]))));else if(a instanceof FormData){const t={};for(const s of a.entries()){const[i,o]=s;t[i]=o instanceof File?o.name:o}e.push(S(t))}else if(ue(a))e.push(S(G(a)));else try{e.push(S(a))}catch{console.warn("[useFetch] Failed to hash body",a)}}return e}const Le={class:"flex items-center justify-center p-4 grow"},qe={class:"text-xl font-semibold text-center"},Ae={key:2,class:"text-error text-sm text-center"},Ie=de({__name:"login",setup(n){const e=E(""),a=E(""),t=E(""),s=E(!1),i=fe(),o=E(!1),r=E(!1),h=he(),{t:_}=_e();me({title:_("common.titles.login")});const c=async()=>{s.value=!0,t.value="";const{data:u,error:l}=await ze("/api/token/",{method:"POST",body:{username:e.value,password:a.value}},"$dyHcPqwtHn");if(s.value=!1,l.value||!u.value?.access){t.value=_("error.invalid_login"),o.value=!0,setTimeout(()=>{o.value=!1},500);return}const b=I("access_token"),d=I("refresh_token");b.value=u.value.access,d.value=u.value.refresh,await Be(),r.value=!0,await i.push(h("index"))};return(u,l)=>{const b=De,d=pe,m=we,g=ve;return R(),q("div",Le,[P(g,{class:ye(["w-full max-w-md shadow-xl rounded-xl",{"animate-shake bg-error":p(o)}])},{header:O(()=>[z("h1",qe,U(p(_)("common.titles.login")),1)]),default:O(()=>[z("form",{onSubmit:ge(c,["prevent"]),class:"space-y-4",method:"post"},[P(d,{label:p(_)("common.labels.username")},{default:O(()=>[P(b,{class:"w-full",modelValue:p(e),"onUpdate:modelValue":l[0]||(l[0]=v=>k(e)?e.value=v:null),placeholder:"you@example.com | YourUserName",type:"text",name:"username",required:""},null,8,["modelValue"])]),_:1},8,["label"]),P(d,{label:p(_)("common.labels.password")},{default:O(()=>[P(b,{class:"w-full",modelValue:p(a),"onUpdate:modelValue":l[1]||(l[1]=v=>k(a)?a.value=v:null),placeholder:"••••••••",type:"password",name:"password",required:""},null,8,["modelValue"])]),_:1},8,["label"]),p(r)?(R(),A(m,{key:0,color:"success",block:"",loading:""},{default:O(()=>[H(U(p(_)("common.titles.redirecting")),1)]),_:1})):(R(),A(m,{key:1,class:"",type:"submit",color:"primary",block:"",loading:p(s)},{default:O(()=>[H(U(p(_)("common.labels.login")),1)]),_:1},8,["loading"])),p(t)?(R(),q("div",Ae,U(p(t)),1)):be("",!0),z("span",null,U(p(_)("common.titles.signup_notice")),1),P(m,{variant:"link",to:p(h)("signUp"),label:p(_)("common.labels.signup")},null,8,["to","label"])],32)]),_:1},8,["class"])])}}});export{Ie as default};
