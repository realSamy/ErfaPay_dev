import{z as V,f as R,h as v,E as M,g as U,j as i,l as I,D as C,v as r,M as F,e as b,ad as T,ae as A,af as $,A as L,a5 as W,I as B,az as E,aA as k,_ as w,k as j,i as S,x as o,a9 as G,G as q}from"./B9jAKPWx.js";import{_ as H}from"./OXrPZgjz.js";import{_ as J}from"./Au9kAsDY.js";import{g as Q,_ as X}from"./CboeWgWE.js";import{_ as Y}from"./f4Ke4YGl.js";import{u as Z}from"./BK8geQZK.js";import{u as ee}from"./BBRQc-sT.js";import{_ as ae}from"./D11N8NiO.js";import"./4JXGHORX.js";import"./B7bqkIxC.js";import"./DGQ0vsRx.js";import"./Dicm8otO.js";const te={class:"flex w-full justify-between"},se={class:"font-medium text-5xl"},oe={class:"flex flex-row gap-1 p-2"},le={class:"flex flex-col gap-2"},ne={class:"flex flex-col gap-2"},ie={class:"flex flex-col gap-2"},re=V({__name:"SimpleReport",props:{header:{},body:{},stats:{}},setup(t){return(s,l)=>{const n=H,_=J,c=M;return U(),R(c,{class:"w-full divide-y-0"},{header:v(()=>[F(C(t.header),1)]),default:v(()=>[i("div",te,[i("span",se,C(s.$n(t.body)),1),t.stats?(U(),R(_,{key:0,mode:"hover"},{content:v(()=>[i("div",oe,[i("div",le,[l[0]||(l[0]=i("span",{class:"text-sm text-muted text-center"},"روز",-1)),r(n,{color:t.stats.day<0?"error":"success",label:s.$n(t.stats.day)+"%","trailing-icon":t.stats.day<0?"material-symbols:arrow-downward":"material-symbols:arrow-upward",class:"self-end",size:"sm",title:"در مقایسه با دیروز",variant:"subtle"},null,8,["color","label","trailing-icon"])]),i("div",ne,[l[1]||(l[1]=i("span",{class:"text-sm text-muted text-center"},"هفته",-1)),r(n,{color:t.stats.week<0?"error":"success",label:s.$n(t.stats.week)+"%","trailing-icon":t.stats.week<0?"material-symbols:arrow-downward":"material-symbols:arrow-upward",class:"self-end",size:"sm",title:"در مقایسه با هفته قبل",variant:"subtle"},null,8,["color","label","trailing-icon"])]),i("div",ie,[l[2]||(l[2]=i("span",{class:"text-sm text-muted text-center"},"ماه",-1)),r(n,{color:t.stats.month<0?"error":"success",label:s.$n(t.stats.month)+"%","trailing-icon":t.stats.month<0?"material-symbols:arrow-downward":"material-symbols:arrow-upward",class:"self-end",size:"sm",title:"در مقایسه با ماه قبل",variant:"subtle"},null,8,["color","label","trailing-icon"])])])]),default:v(()=>[r(n,{color:t.stats.month<0?"error":"success",label:s.$n(t.stats.month)+"%","trailing-icon":t.stats.month<0?"material-symbols:arrow-downward":"material-symbols:arrow-upward",class:"self-end",size:"sm",title:"در مقایسه با ماه قبل",variant:"subtle"},null,8,["color","label","trailing-icon"])]),_:1})):I("",!0)])]),_:1})}}}),ce=Object.assign(re,{__name:"CardAdminSimpleReport"}),me=()=>{const t=b([]),s=b(!1),l=async d=>{s.value=!0;const m=d?{status:d}:{};try{const{data:u}=await A("/api/payments/admin/charges/",{params:m});t.value=u.value?.data||[]}catch{$().add({title:"خطا در بارگذاری شارژها",color:"error"})}finally{s.value=!1}},n=async d=>{const{error:m}=await A(`/api/payments/admin/charges/${d}/approve/`,{method:"POST"});m.value||($().add({title:"شارژ تایید شد",color:"success"}),await l())},_=async d=>{const{error:m}=await A(`/api/payments/admin/charges/${d}/reject/`,{method:"POST"});m.value||($().add({title:"شارژ رد شد",color:"error"}),await l())},c=async d=>{const{data:m,error:u}=await A("/api/payments/admin/adjustment/",{method:"POST",body:d});return u.value?($().add({title:"خطا در تنظیم کیف پول",color:"error"}),null):($().add({title:"کیف پول تنظیم شد",color:"success"}),m.value)};return{charges:T(t),loading:T(s),fetchAdminCharges:l,approveCharge:n,rejectCharge:_,adjustWallet:c}},de={class:"w-full space-y-4 pb-4"},ue={class:"flex justify-between px-4 py-3.5 border-b border-accented"},pe={class:"text-center py-8"},_e={class:"text-lg font-medium text-gray-900 mb-1"},ge={class:"text-sm text-gray-500"},fe={class:"flex justify-center border-t border-default pt-4"},be=V({__name:"users",async setup(t){let s,l;const n=w,_=q,{t:c,d}=L(),m=W(),u=([s,l]=B(()=>Z()),s=await s,l(),s),g=E("table"),x=b({}),y=b(""),z=b({pageIndex:0,pageSize:5}),O=b([{accessorKey:"id",header:"#",size:8},{accessorKey:"full_name",header:c("common.tables.user_name"),cell:({row:a})=>{const e=a.original.country_code?.toLowerCase(),f=a.original.id,h=`${a.original.first_name} ${a.original.last_name}`;return k(w,{icon:e?`cif:${e}`:"material-symbols:globe",label:h,variant:"link",to:m({name:"admin-users-id",params:{id:f}})})},size:24},{accessorKey:"email",header:c("common.tables.email"),size:32},{accessorKey:"role",header:c("common.tables.role"),cell:({row:a})=>({main_admin:c("common.roles.main_admin"),senior_support:c("common.roles.senior_support"),simple_support:c("common.roles.simple_support"),regular:c("common.roles.regular")})[a.getValue("role")]||a.original.role},{accessorKey:"last_login",header:c("common.tables.last_login"),cell:({row:a})=>{const e=a.getValue("last_login");return e?d(e,{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit",hour12:!1}):"-"}},{id:"operations",header:c("common.tables.operations"),enableSorting:!1,size:20,cell:({row:a})=>{const e=a.original.id;return k("div",{class:"flex gap-1"},[k(w,{variant:"ghost",color:"info",icon:"material-symbols:attach-money",onClick:()=>D(e)}),k(w,{variant:"ghost",color:a.original.is_blocked?"warning":"success",title:a.original.is_blocked?"common.states.enable":"common.states.disable",icon:a.original.is_blocked?"material-symbols:account-circle-off-outline-rounded":"material-symbols:account-circle-outline",onClick:()=>K(e)}),k(w,{variant:"ghost",color:"error",icon:"material-symbols:delete-outline",onClick:()=>N()})])}}]),K=a=>{const e=u.value.find(f=>f.id===a);e&&(e.is_blocked=!e.is_blocked)},N=a=>{confirm("آیا مطمئن هستید؟")},D=async a=>{const{adjustWallet:e}=me(),f={amount:0,reason:""},h=await ee()(f,{amount:{label:"Amount"},reason:{label:"Reason"},user_id:{label:"User"}});if(h){const P=await e({...h,user_id:a});console.log(P)}};return(a,e)=>{const f=G,h=X,P=Y;return U(),j("div",de,[i("div",ue,[r(f,{modelValue:o(y),"onUpdate:modelValue":e[0]||(e[0]=p=>S(y)?y.value=p:null),placeholder:a.$t("common.tables.search"),class:"max-w-sm",icon:"material-symbols:search",type:"search"},null,8,["modelValue","placeholder"]),r(o(n),{label:a.$t("common.tables.download"),icon:"material-symbols:download"},null,8,["label"])]),r(h,{ref_key:"table",ref:g,"global-filter":o(y),"onUpdate:globalFilter":e[1]||(e[1]=p=>S(y)?y.value=p:null),pagination:o(z),"onUpdate:pagination":e[2]||(e[2]=p=>S(z)?z.value=p:null),"row-selection":o(x),"onUpdate:rowSelection":e[3]||(e[3]=p=>S(x)?x.value=p:null),columns:o(O),data:o(u),"pagination-options":{getPaginationRowModel:o(Q)()},class:"w-full h-100",sticky:""},{empty:v(()=>[i("div",pe,[r(o(_),{class:"mx-auto h-12 w-12 text-gray-400 mb-4",name:"i-hero-users"}),i("h3",_e,C(a.$t("common.messages.warn_no_user")),1),i("p",ge,C(a.$t("common.messages.warn_add_users_to_show")),1)])]),_:1},8,["global-filter","pagination","row-selection","columns","data","pagination-options"]),i("div",fe,[r(P,{"default-page":(o(g)?.tableApi?.getState().pagination.pageIndex||0)+1,"items-per-page":o(g)?.tableApi?.getState().pagination.pageSize,total:o(g)?.tableApi?.getFilteredRowModel().rows.length,"onUpdate:page":e[4]||(e[4]=p=>o(g)?.tableApi?.setPageIndex(p-1))},null,8,["default-page","items-per-page","total"])])])}}}),ye=Object.assign(be,{__name:"TableAdminUsers"}),he={class:"space-y-12"},we={class:"flex gap-2"},ve={key:0,class:"flex flex-col md:flex-row gap-6"},xe={class:"page-section"},Ie=V({__name:"index",async setup(t){let s,l;const n=b(),{data:_}=([s,l]=B(()=>A("/api/auth/admin/users/stats/")),s=await s,l(),s);return _.value?.ok&&(n.value=_.value.data),(c,d)=>{const m=w,u=ce,g=ye,x=ae;return U(),j("div",he,[i("div",we,[r(m,{label:"دانلود CSV",size:"lg","trailing-icon":"material-symbols:download-rounded"}),r(m,{label:"کاربر جدید",to:c.$localePath("admin-users-new"),size:"lg","trailing-icon":"material-symbols:add"},null,8,["to"])]),o(n)?(U(),j("div",ve,[r(u,{header:"سفارش های فعال",body:o(n).total_active_orders},null,8,["body"]),r(u,{header:"اعضای خریدار",body:o(n).total_active_users,stats:o(n).active_users_growth},null,8,["body","stats"]),r(u,{header:"تعداد کل اعضا",body:o(n).total_users,stats:o(n).new_users_growth},null,8,["body","stats"])])):I("",!0),i("section",xe,[r(x,null,{default:v(()=>[r(g)]),_:1})])])}}});export{Ie as default};
